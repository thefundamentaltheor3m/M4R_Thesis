\section{The Formalisation Effort}
\label{Ch5:Sec:Gen_Overview_of_Formalisation}

As was mentioned in \Cref{Ch1:Chapter}, the formalisation of Viazovska's proof was initiated by Viazovska and Hariharan in March 2024. A public announcement was made in June 2024, following which Birkbeck, Lee, and Ma joined the collaboration. Macbeth and Mehta too have made significant contributions since October 2024.

All code pertaining to the formalisation of the contents of \Cref{Ch4:Chapter} that does not come from the broader theory of modular forms has been written solely by the author, with advice from Mehta. While the formalisation is not complete, the author's progress is best interpreted as providing important tools and frameworks that will significantly ease the remainder of the formalisation.

The most significant difference between the author's exposition and Viazovska's original proof is that the author uses six defining integrals instead of four, with all contours being rectangular. The reason this is useful is that a formal version of the \CGT\ that exists in \mathlib\ for rectangular contours. A crucial step in \Cref{Ch4:Sec:Double_Zeroes} involves deforming unbounded contours, and the author formalised an appropriate version of the \CGT\ to work around this problem. The author's work builds on the \mathlib\ version for bounded rectangular contours, and hypothesised that it would be easier to adapt the definitions and proofs preceding that of double zeroes to a function defined using rectangular contours than it would to prove an unbounded version of the \CGT\ involving circular or triangular contours. Unfortunately, the proof of the eigenfunction property is not compatible with rectangular contours, but the author remains confident in the possibility of a workaround. We continue this discussion in \Cref{Ch5:Sec:Cauchy-Goursat}.

Viazovska's proof is heavy on computation. At the beginning of this M4R, the author was unaccustomed to proving computationally intensive results in Lean. While early attempts involved writing lengthy calculation lemmas, the author soon discovered that breaking computations into several lemmas corresponding to individual steps improved not only readability but also compilation time. The author's formal proof of \Cref{SP:PolyFourierCoeffBound}, for example, consists of thirteen auxiliary lemmas corresponding to individual steps, and the author's formal proofs of the bounds on each of the $I_1, \ldots, I_6$ are spread across two files: one with alternate expressions for all the $I_j$s and one with bounds on the $I_j$ in question. A further advantage of this approach is its isolation of dependencies that are difficult to formalise, such as convergence results for sums, products and integrals that arise in either the statement or proof of a result. In some cases, one finds workarounds: for instance, when bounding the $I_j$, the author realised that the proof that the $I_j$ converge absolutely is not necessary because of the way integrals are defined in \mathlib. The necessity of such excruciating detail in formal proofs was the author's key motivator to provide detailed arguments in \Cref{Ch4:Chapter}: the author's intent is for the proofs in this thesis to be a bridge between the informal and the formal, building on Viazovska's arguments in \cite[\S 7]{blueprint}.

For the remainder of this section, we briefly discuss two important general contributions the author made to the formalisation. We then move onto two dedicated sections that respectively describe the metaprogramming approach implemented by Macbeth, Xie and the author and the challenges associated with the \CGT\ and how some, though not all, of them have been overcome.

\subsection{A Systematic Approach to Bounding Integrals}

Before the idea of rectangular contours, the author attempted to express $I_1 + I_2$ using a triangular contour. In fact, the author succeeded in bounding it by following the arguments in \cite{Viazovska8}. However, once the idea of rectangular contours was conceived, the author realised that six integrals would need to be bounded instead of four, as in \cite{Viazovska8}. The author hence decided to systematise his approach to maximise reusability of code. Indeed, that the proofs of \Cref{Ch4:Lemma:Bound_I1_I3_I5,Ch4:Lemma:Bound_I2_I4,Ch4:Lemma:Bound_I6} are direct informalisations of the formal proofs found in the repository. There is one file per integral in the directory \lstinline|MagicFunction.a.IntegralEstimates|, but the structure is nearly identical for those integrals bounded using the same techniques, reflecting the systematic nature of the approach. All specific references in this subsection will involve the $I_j$, though we emphasise, as we did in \Cref{Ch4:Subec:Schwartzness_b}, that the $J_j$ are similar.\todo{Maybe rephrase if we don't finish bounding the Js in time}

The integrals are defined using parametrisations involving a real variable, so that API on \lstinline|intervalIntegral| could be used. To maximise compatibility, the most frequently used versions of the $\phi$-functions and the parametrisations are extensions of these functions to $\C$ and $\R$ respectively that are $0$ outside of where they are meant to be defined. This is in line with the \mathlib\ style of defining constructions like sums, integrals and products to take trivial values outside when these constructions are not well-defined in informal mathematics. We now give a step-by-step breakdown of how the author bounded integrals in Lean.

\begin{enumerate}
    \item \underline{Expressing the integrands in a convenient form.}

    Aside from enhancing readability and underscoring the resemblance of the formal integrals to the informal integrals, parametrisations are a way to control the variable of integration. However, they come with a layer of syntax that is unhelpful for bounding. Hence, we define lemmas ending in \lstinline|_eq| and \lstinline|_eq'| to overcome them.
    
    \lstinline|_eq| lemmas expand the parametrisations and perform basic simplifications, such as separating a term of the form $e^{\pi i r\parenth{1 + it}}$ into $e^{\pi i r} \cdot e^{-\pi r t}$. \lstinline|_eq'| lemmas take any scalars arising from this process (such as a factor of $i$ from a parametrisation $z = 1 + it$) outside of the integral, which makes them easier to deal with when bounding the integral. These lemmas are proved in \lstinline|MagicFunction.a.Basic| for all , whereas the remaining steps

    \item \underline{Changing variables (first, third and fifth integrals only).}

    Informally and formally, the key to bounding the first, third, and fifth integrals of both eigenfunctions is to perform a change of variables $s = \frac{1}{t}$. We do this by applying \href{https://github.com/leanprover-community/mathlib4/blob/5a2eaa85c555c4263e15928cef249cbaad2eb2d2/Mathlib/MeasureTheory/Function/Jacobian.lean#L1199}{a previously formalised \mathlib\ result} using functions \lstinline|f|, \lstinline|f'| and \lstinline|g|, defined at the top of each file, denoting the variable change, its derivative, and the desired form of the integrand \textbf{after} the change of variables. Just as in this thesis, the author applied the convention of using \lstinline|s| to denote the integration variable after the change and \lstinline|t| to denote it before. An intermediate lemma navigates syntactic challenges, reconciling the integral in \lstinline|t| whose integrand is a composition \lstinline|g| with \lstinline|f|.

    \item \underline{Bounding the integrand.}

    By inspection, one sees that in \Cref{Ch4:Lemma:Bound_I1_I3_I5,Ch4:Lemma:Bound_I2_I4,Ch4:Lemma:Bound_I6}, the bounds on the integrals actually come from bounds on the integrands. This is done formally using two lemmas, the first performing elementary bounds and the second applying \Cref{SP:PolyFourierCoeffBound}. 
\end{enumerate}

\subsection{A Schwartzness Bridge Across Dimensions}