\section{A Word on Modular Forms}
\label{Ch2:Sec:ModForms}

\begin{comment}
Things to discuss:
1. What is a modular form
2. What is a quasimodular form
3. Examples: Eisenstein Series, Jacobi Theta functions, Discriminant form
We can reference things like the q-expansions of the Eisenstein series, the transformation rules for the Jacobi theta functions, and the product formula for the discriminant form.
\end{comment}

In this section, we give a brief introduction to the theory of modular forms. Birkbeck, Loeffler and others have formalised several results in the theory of modular forms, and a significant portion of their work has been merged into \mathlib. Definitions and results from this section that pertain to Viazovska's solution to the sphere packing problem in $\R^8$ that do not feature in \mathlib\ are being actively formalised by Birkbeck and Lee, with contributions from Ma.

First, we introduce the following useful notation.

\begin{boxnotation}
    For the remainder of this paper, denote the Complex upper half-plane by $\Halfplane$. That is, define $\Halfplane := \setst{z \in \C}{0 < \Im(z)}$.
\end{boxnotation}

This corresponds to the \mathlib\ notation for the upper half-plane.

A key motivating idea in the study of modular forms is the study of the action of $\SL{2, \Z}$ on $\Halfplane$ by Möbius transformations via
\begin{align*}
    \begin{bmatrix}
        a & b \\ c & d
    \end{bmatrix}
    \cdot z := \frac{az + b}{cz + d}
\end{align*}
That matrix multiplication corresponds to the composition of Möbius transformations is a well-known fact in Complex Analysis. One can hence show that the above is indeed a group action.

Both the identity $I \in \SL{2, \Z}$ and the negative identity $-I \in \SL{2, \Z}$ have the same (trivial) action on $\Halfplane$. Indeed, the $\SL{2, \Z}$ action descends to a faithful action of $\PSL{2, \Z} = \quotient{\SL{2, \Z}}{\set{\pm I}}$ on $\Halfplane$. Since we are more interested in the \textit{actions} of matrices in $\SL{2, \Z}$ and $\PSL{2, \Z}$ than we are in their entries, we often do not distinguish between the two groups.

The \mathlib\ definition of a modular form is more general than the first definitions of modular forms often seen in literature (see \cite[Chapter VII, \S 2, Definition 4]{SerreArith} and \cite[Definition 1.1.2]{DiamondShurman}), and instead matches subsequent definitions that generalise these first definitions. Modular forms are usually described as functions that are holomorphic on the upper half-plane that are invariant under the $\SL{2, \Z}$-action up to an \textit{automorphy factor} of a certain \textit{weight}. This \textit{weight} is defined as the \textit{weight of the modular form}. However, one is often interested in invariance under not all of $\SL{2, \Z}$, but certain \textit{principal congruence subgroups} or subgroups containing such subgroups, known as \textit{congruence subgroups}. Each principal congruence subgroup has a \textit{level}, which is defined to be the \textit{level} of a modular form whose congruence subgroup is principal. Modular forms, as they are defined in \mathlib\ and in the blueprint \cite{blueprint}, are therefore indexed by two properties: a \textit{congruence subgroup of $\SL{2, \Z}$}, which indicates the scope of invariance under the $\SL{2, \Z}$-action, and a \textit{weight}, which gives the extent of invariance under the action of elements of the subgroup in question.

To give a complete definition of the weight of a modular form, we need to define automorphy factors and the slash action notation.

\begin{boxdefinition}[Automorphy Factors and Slash Actions]\label{Ch2:Def:Aut_Factor_Slash_Action}
    Fix $k \in \Z$, $z \in \Halfplane$ and $\gamma = \begin{bmatrix} a & b \\ c & d \end{bmatrix} \in \SL{2, \Z}$. Define the \textbf{automorphy factor of weight $k$} to be
    \begin{align}
        j_k\of{z, \gamma} &:= \parenth{cz + d}^{-k}
        \label{Ch2:Eq:AutomorphyFactor_def}
    \end{align}
    For any function $f : \Halfplane \to \C$, with $k$ and $\gamma$ as above, the \textbf{slash operator} maps $f$ to a new function $f \mid_k \gamma : \Halfplane \to \C$ given by
    \begin{align}
        \fmof{k}{\gamma}{z} &:= j_k\of{z, \gamma} \fof{\gamma \cdot z} = \parenth{cz + d}^{-k} \fof{\frac{az + b}{cz + d}}
        \label{Ch2:Eq:SlashAction_def}
    \end{align}
    The action of $\gamma$ mapping $f$ to $\fm_k \gamma$ via the weight $k$ slash operator is sometimes referred to as a \textbf{slash action}.
\end{boxdefinition}

It is clear, from the above definition, that $\fm_0 \gamma = f \circ \gamma$ for al $\gamma \in \SL{2, \Z}$. That is, if $f = \fm_0 \gamma$, then $f = f \circ \gamma$, that is, $f$ is invariant under composition with (the action of) $\gamma$. If $f = \fm_k \gamma$ for some $k \in \Z$ and $\gamma \in \SL{2, \Z}$, we can view the weight $k$ as indicating the `extent of invariance' of $f$ under composition with $\gamma$.

To give a complete definition of the congruence subgroup/level of a modular form, we need to define congruence subgroups. The idea is to express the scope of the slash-invariance exhibited by a modular form with respect to the action of $\SL{2, \Z}$---that is, the set of elements of $\SL{2, \Z}$ under which we have slash-invariance---in the language of modular arithmetic.

\begin{boxdefinition}[Congruence Subgroup]\label{Ch2:Def:Cong_Subgroup}
    Fix $N \in \N$. The \textbf{level $N$ principal congruence subgroup} of $\SL{2, \Z}$, denoted $\Gamma(N)$, is defined to be the kernel of the surjective group homomorphism from $\SL{2, \Z}$ to $\SL{2, \Zmod{N}}$ that comes from reducing modulo $N$. That is,
    \begin{align}
        \Gamma(N) &:= \setst{
        \begin{bmatrix}
            a & b \\ c & d
        \end{bmatrix} \in \SL{2, \Z}}{
        \begin{bmatrix}
            a & b \\ c & d
        \end{bmatrix}
        \equiv
        \begin{bmatrix}
            1 & 0 \\ 0 & 1
        \end{bmatrix}
        \pmod{N}}
        \label{Ch2:Eq:PrincipalCongruenceSubgroup_def}
    \end{align}
    More generally, a subgroup $\Gamma$ of $\SL{2, \Z}$ is called a \textbf{congruence subgroup} if $\Gamma(N) \subset \Gamma$ for some $N \in \N$.
\end{boxdefinition}

We now have enough to define what it means for a holomorphic function to be invariant under the slash action of a congruence subgroup. In the definition of modular forms, however, we include an additional condition that is often referred to as \textit{holomorphicity at $i\infty$}, the purpose of which is to ensure that spaces of modular forms, which turn out to admit $\C$-vector space structures, are, in fact, finite-dimensional \cite{KevinFamilies}.

The theory of modular forms is often thought to lie in the very rich intersection of algebra and analysis. Our definitions so far have been largely algebraic, but our next one is analytic. Consider the mapping $q : \Halfplane \to \C : z \mapsto e^{2\pi i z}$. This maps $\Halfplane$ to the punctured, open unit disc
\begin{align*}
    D := \setst{w \in \C}{0 < \abs{q} < 1}
\end{align*}
Indeed, for all $z \in \Halfplane$, writing $z = x + iy$ for $x, y \in \R$ with $y > 0$, we have
\begin{align*}
    \abs{q(z)} = \abs{e^{2 \pi i \parenth{x + iy}}} = \abs{e^{2\pi i x}} \cdot \abs{e^{-2\pi y}} < 1
\end{align*}
with $0 \notin q\of{\Halfplane}$ but $q(z) \to 0$ as $\Im(z) = y \to \infty$. Now, we know that the holomorphic functions from $D \to \C$ are precisely those that have Laurent expansions of the form
\begin{align*}
    \sum_{n=0}^{\infty} c_n w^n
\end{align*}
for all $w \in D$. If we write $w = q(z)$ for $z \in \Halfplane$, the above series turns out to be a \textit{Fourier expansion}. We can hence make the following definition for holomorphicity at $i\infty$.

\begin{boxdefinition}[Holomorphicity at $i\infty$]\label{Ch2:Def:Holo_at_ImInfty}
    We say a function $f : \Halfplane \to \C$ is \textbf{holomorphic at $i\infty$} if $f$ admits a Fourier expansion of the form
    \begin{align*}
        f(z) = \sum_{n=0}^{\infty} c_n q(z)^n = \sum_{n=0}^{\infty} c_n e^{2\pi i nz}
    \end{align*}
    That is, $f$ admits a Fourier expansion with no negative powers of $q(z)$.
\end{boxdefinition}

The holomorphicity of $f$ at $i\infty$ essentially means that the Fourier expansion of $f$ is a holomorphic $D \to \C$ function in $q(z)$, with the added constraint that $\abs{f(z)}$ remains bounded as $\Im(z) \to \infty$, that is, the corresponding $D \to \C$ function in $q(z)$ extends to a holomorphic function that is defined and bounded at $0$. There is a rich theory of functions where $c_0 = 0$, but we will not explore that theory here.

We are now ready to define modular forms. Intuitively, a modular form is a function that satisfies the above definitions in a slash-invariant manner. More precisely, we have the following.

\begin{boxdefinition}[Modular Form]
    Fix $k \in \Z$ and let $\Gamma$ be a congruence subgroup of $\SL{2, \Z}$. We say a function $f : \Halfplane \to \C$ is a \textbf{modular form of weight $k$ with respect to $\Gamma$} if $f$ is \textbf{invariant} under the slash action of $\Gamma$ and \textbf{holomorphic at $i\infty$} under the slash action of $\SL{2, \Z}$. That is,
    \begin{enumerate}
        \item For all $\gamma \in \Gamma$, $\fm_k \gamma = f$ (cf. \Cref{Ch2:Def:Aut_Factor_Slash_Action}).
        \item For all $\gamma \in \SL{2, \Z}$, $\fm_k \gamma$ is holomorphic at $i\infty$ (cf. \Cref{Ch2:Def:Holo_at_ImInfty}).
    \end{enumerate}
    We denote by $M_k(\Gamma)$ the space of modular forms of weight $k$ and congruence subgroup $\Gamma$. If $\Gamma = \Gamma(N)$ for some $N \in \N$, we say an element of $M_k(\Gamma)$ has \textbf{level $N$}.
\end{boxdefinition}

There is an immensely rich theory of modular forms, and for the purposes of practicality, it was decided not to explore this theory in great detail in this project, particularly because the formalisation of the aspects of Viazovska's proof that stem from this theory is being led by Birkbeck, Lee and Ma. We will instead use the remainder of this section to discuss three specific (families of) modular forms and those of their properties that Viazovska uses to construct her magic function.

\subsection{The Eisenstein Series}

The Eisenstein Series are an important family of slash-invariant forms that will prove essential to the construction of the magic function. The Eisenstein Series whose \textit{weight} is an even integer that is at least $4$ are modular forms, though we will also need to work with the Eisenstein Series of weight $2$, which, despite not being a modular form, is sufficiently well-behaved for our purposes. We will define it separately from those Eisenstein Series that are modular forms.

Let $k \geq 4$ be an even integer. We denote by $E_k$ the weight $k$ Eisenstein Series. There is more than one way to define $E_k$. In this report, we give the definition that was formalised by Birkbeck for this project. Birkbeck's definition in the project repository is a particular case of the \href{https://github.com/leanprover-community/mathlib4/blob/70816aec3a0f7bb98ac42991652a66b6405e1a00/Mathlib/NumberTheory/ModularForms/EisensteinSeries/Basic.lean#L28-L35}{\mathlib\ definition}, which defines it as a \texttt{ModularForm} structure combining the function \href{https://github.com/leanprover-community/mathlib4/blob/70816aec3a0f7bb98ac42991652a66b6405e1a00/Mathlib/NumberTheory/ModularForms/EisensteinSeries/Defs.lean#L107}{\texttt{eisensteinSeries}} with the proofs of the properties that make it a modular form. The \mathlib\ definition is more general than the one we study here, and involves imposing congruence conditions on the subsets of the lattice $\Z^2$ over which the Eisenstein Series are summed. It is not necessary for this project.

\begin{boxdefinition}[The Eisenstein Series of Even Weight $\geq 4$]\label{Ch2:Def:EisensteinSeries_geq_4}
    For $k \geq 4$ even, define the \textbf{weight $k$ Eisenstein Series} to be the function $E_k : \Halfplane \to \C$ given by
    \begin{align*}
        E_k(z) := \frac{1}{2} \sum_{\substack{\parenth{m, n} \in \Z^2 \\ \gcd(m, n) = 1}} \frac{1}{\parenth{mz + n}^k}
    \end{align*}
    with the defining summation converging absolutely.
\end{boxdefinition}

Note that the Eisenstein Series can also be defined as
\begin{align*}
    E_k(z) = \frac{1}{2\zeta(k)} \sum_{\parenth{m, n} \in \Z^2 \setminus \set{0}} \frac{1}{\parenth{mz + n}^k}
\end{align*}
with $\zeta$ here denoting the Riemann zeta function. It is shown in \cite[Equation (4.1), pp. 109-110]{DiamondShurman} that this definition matches the definition formalised by Birkbeck in the project repository and stated informally in \Cref{Ch2:Def:EisensteinSeries_geq_4}.\todo{Blueprint gives zeta def whereas repo gives coprime def. WHOOPSIE!}

It is shown in \cite[pp. 4-5]{DiamondShurman} that $E_k$ is a weight $k$, level $1$ modular form for even integers $k \geq 4$. That is, $E_k$ is invariant under the weight $k$ slash-action of every element of $\SL{2, \Z}$. As important special cases of this, $E_k$ satisfies two important functional equations.

\begin{boxproposition}\label{Ch2:Prop:Eisenstein_func_eq}
    For all even $k \geq 4$ and $z \in \Halfplane$, the following both hold:
    \begin{align}
        E_k\of{z + 1} &= E_k \label{Ch2:Eq:Ek_func_eq_one_add} \\
        E_k\of{-\frac{1}{z}} &= z^k E_k(z) \label{Ch2:Eq:Ek_func_eq_neg_one_div}
    \end{align}
\end{boxproposition}
\begin{proof}
    Both of these are just slash-invariance properties in disguise. We have\todo{Fix slash formatting}
    \begin{align*}
        E_k(z + 1) = \parenth{E_k \; \middle\vert_k \; {\begin{bmatrix} 1 & 1 \\ 0 & 1 \end{bmatrix}}}\of{z} = \parenth{0z + 1}^{k} E_k(z) = E_k(z)
    \end{align*}
    Similarly, we have
    \begin{align*}
        E_k\of{-\frac{1}{z}} = \parenth{E_k \; \middle\vert_k \; {\begin{bmatrix} 0 & -1 \\ 1 & 0 \end{bmatrix}}}\of{z} = \parenth{1z + 0}^k E_k(z) = z^k E_k(z)
    \end{align*}
    as required.
\end{proof}

The functional equations \eqref{Ch2:Eq:Ek_func_eq_one_add} and \eqref{Ch2:Eq:Ek_func_eq_neg_one_div} yield similar results for an important function that will be used in constructing the magic function. We will explore this idea in \Cref{Ch4:Chapter}.

The final result we will state about the Eisenstein Series (of weight $\geq 4$) is that their Fourier expansions take a particular form. We will be particularly interested in $E_4$ and $E_6$, which will show up in the definition of the magic function. First, we need to define the arithmetic function $\sigma_k(n)$, which is defined in \mathlib\ as \href{https://github.com/leanprover-community/mathlib4/blob/70816aec3a0f7bb98ac42991652a66b6405e1a00/Mathlib/NumberTheory/ArithmeticFunction.lean#L797-L799}{\texttt{ArithmeticFunction.sigma}}.

\begin{boxtheorem}\label{Ch2:Thm:Ek_qexpansion}
    For all even $k \geq 4$ and $z \in \Halfplane$, $E_k(z)$ can be expressed as the Fourier series
    \begin{align*}
        E_k(z) &= 1 + C_k \sum_{n=1}^{\infty} \sigma_{k-1}\of{n} e^{2\pi i n z}
    \end{align*}
    where
    \begin{align*}
        C_k = \frac{1}{\zeta(k)} \cdot \frac{\parenth{-2 \pi i}^k}{\parenth{k-1}!}
    \end{align*}
    In particular, $C_4 = 240$ and $C_6 = -504$. That is, $E_4$ and $E_6$ have the following Fourier expansions:
    \begin{align}
        E_4(z) &= 1 + 240 \sum_{n=1}^{\infty} \sigma_3(n) e^{2 \pi i n z} \label{Ch2:Eq:E4_qexpansion} \\
        E_6(z) &= 1 - 504 \sum_{n=1}^{\infty} \sigma_5(n) e^{2 \pi i n z} \label{Ch2:Eq:E6_qexpansion}
    \end{align}
\end{boxtheorem}

The statement and proof of the general Fourier expansion of $E_k$ for even $k \geq 4$ have been \href{https://github.com/thefundamentaltheor3m/Sphere-Packing-Lean/blob/076f4b8d6a37fa95de3bc4764a5d7f911fde91e0/SpherePacking/ModularForms/Eisensteinqexpansions.lean#L301}{formalised by Birkbeck} in the Sphere Packing repository.\todo{Here, again, the repo disagrees with the blueprint. FIX!} Substituting $k = 4$ and $k = 6$ in the expression for $C_k$ and evaluating it using software like Wolfram|Alpha gives the desired result.

% TODO: RAISE THIS ON ZULIP. Mention that we need to correct the blueprint to reflect the repo version.

\subsection{The Thetanullwerte}

\subsection{The Discriminant Form}